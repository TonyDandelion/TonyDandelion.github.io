

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&quot;dark&quot;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="知无涯者">
  <meta name="keywords" content="">
  <title>Python爬虫入门 - 代码即艺术</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/monokai.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>代码即艺术</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/introduction/">
                <i class="iconfont icon-map"></i>
                入门
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/404page.html">
                <i class="iconfont icon-heartbeat"></i>
                公益404
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Python爬虫入门">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-04-12 15:21" pubdate>
        2020年4月12日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      100
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Python爬虫入门</h1>
            
            <div class="markdown-body">
              <p><img src="https://i.loli.net/2020/04/12/3lECGYNQFn29Dgi.png" srcset="/img/loading.gif" alt="Snipaste_2020-04-12_17-09-34.png"  /></p>
<p>整理回顾了一下一篇四年前（2016年4月）写的Python爬虫博客 主要内容是当时从<a target="_blank" rel="noopener" href="https://cuiqingcai.com/">崔庆才大佬的网站</a>上整理出来的 现在时代变了，网站基本上都有了混淆或者一些接口加了很多加密参数 所以后面应该会补上一篇总结 <code>JavaScript</code> 逆向和 <code>App</code> 逆向技术结合Python爬虫解决实际问题的文章</p>
<a id="more"></a>
<h1 id="开发爬虫的步骤">开发爬虫的步骤</h1>
<ul>
<li>确定目标</li>
<li>分析目标，形成抓取策略
<ul>
<li>URL格式</li>
<li>数据格式</li>
<li>网页编码</li>
</ul></li>
<li>编写代码</li>
<li>执行爬虫</li>
</ul>
<h1 id="python网页下载器">Python网页下载器</h1>
<p>urllib2：这是Python的官方基础模块 requests：这是一个更强大的第三方包</p>
<h2 id="urllib2的使用方法">urllib2的使用方法</h2>
<p>将url传入到urllib2.urlopen(url)，这样就会直接得到一个网页的数据，这是最简洁的方法。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-comment">#直接请求</span><br>response = urllib2.urlopen(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>)<br><br><span class="hljs-comment">#利用response的getcode()方法来获取状态码，如果是200就表示成功</span><br><span class="hljs-built_in">print</span> response.getcode()<br><br><span class="hljs-comment">#读取内容</span><br>cont = response.read()<br></code></pre></div></td></tr></table></figure>
<p>添加data、http header</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#使用request方法做请求更为合理，符合网络请求的逻辑。</span><br><span class="hljs-keyword">import</span> urllib2<br>request = urllib2.Request(url) <span class="hljs-comment">#生成Request对象</span><br>request.add_data(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>) <span class="hljs-comment">#添加数据</span><br>request.add_header(<span class="hljs-string">&#x27;User-Agent&#x27;</span>,<span class="hljs-string">&#x27;Mozilla/5.0&#x27;</span>) <span class="hljs-comment">#添加http的header，将爬虫伪装成Mozilla浏览器</span><br>response = urllib2.urlopen(request) <span class="hljs-comment">#发送请求获取结果</span><br><span class="hljs-comment">#也可以这样做</span><br>user_agent = <span class="hljs-string">&#x27;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&#x27;</span><br>values = &#123;<span class="hljs-string">&#x27;username&#x27;</span> : <span class="hljs-string">&#x27;cqc&#x27;</span>,  <span class="hljs-string">&#x27;password&#x27;</span> : <span class="hljs-string">&#x27;XXXX&#x27;</span> &#125;  <br>headers = &#123; <span class="hljs-string">&#x27;User-Agent&#x27;</span> : user_agent &#125;  <span class="hljs-comment">#添加http的header，将爬虫伪装成Mozilla浏览器</span><br>data = urllib.urlencode(values)  <br>request = urllib2.Request(url, data, headers) <span class="hljs-comment">#将用户信息和header信拼装进request</span><br>response = urllib2.urlopen(request)  <br>page = response.read() <br></code></pre></div></td></tr></table></figure>
<p>POST和GET数据传送 <figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#POST和GET数据传送</span><br><span class="hljs-comment">#POST方法</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> urllib<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-meta">&gt;&gt;&gt; </span>valuse = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;123@qq.com&#x27;</span>,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;123&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>data = urllib.urlencode(valuse) <span class="hljs-comment">#准备账号密码</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&quot;http://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn&quot;</span> <span class="hljs-comment">#准备url</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>request = urllib2.Request(url,data) <span class="hljs-comment">#生成request 在把data传进去之前，我们要先使用urllib的urlencode方法生成有账户密码等信息的data</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>response = urllib2.urlopen(request) <span class="hljs-comment">#获取response </span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> response.read()<br><br><span class="hljs-comment">#urlopen用POST方法传账户密码的逻辑顺序：账号密码信息存到一个dict（valuse）里面 ---&gt; 用urllib的urlencode方法把dict（valuse）里面的账户、密码信息封装到data里面 ---&gt; 用urllib2的Request以目标url和data为参数生成一个request ---&gt; 调用urllib2的urlopen方法以request为参数获得response</span><br><br><span class="hljs-comment">#GET方法</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>values = &#123;&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>valuse[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;123@qq.com&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>valuse[<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;123&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>data = urllib.urlencode(valuse)<br><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&quot;http://passport.csdn.net/account/login&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>geturl = url + <span class="hljs-string">&#x27;?&#x27;</span> + data<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> geturl<br>http://passport.csdn.net/account/login?username=123%40qq.com&amp;password=123<br><span class="hljs-meta">&gt;&gt;&gt; </span>request = urllib2.Request(geturl)<br><span class="hljs-meta">&gt;&gt;&gt; </span>response = urllib2.urlopen(request)<br></code></pre></div></td></tr></table></figure> <strong><em>urlopen(url, data, timeout)</em></strong> 第一个参数url即为URL，第二个参数data是访问URL时要传送的数据，第三个timeout是设置超时时间。 第二三个参数是可以不传送的，data默认为空None，timeout默认为 socket._GLOBAL_DEFAULT_TIMEOUT 第一个参数URL是必须要传送的，执行urlopen方法之后，返回一个response对象，返回信息便保存在这里面。</p>
<blockquote>
<p>添加特殊的情景处理器</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#需要cookie才能访问的网页：HTTPCookieProcessor</span><br><span class="hljs-comment">#需要代理才能访问的网页：ProxyHandler</span><br><span class="hljs-comment">#使用Https加密协议访问的网页：HTTPSHandler</span><br><span class="hljs-comment">#有页面跳转的网页：HTTPRedirectHandler</span><br><span class="hljs-keyword">import</span> utllib2, cookielib<br><span class="hljs-comment">#创建cookie容器</span><br>cj = cookielib.CookieJar()<br><br><span class="hljs-string">&#x27;&#x27;&#x27;创建1个opener，HTTPCookieProcessor()以cj为参数是一个cookie处理器，生成一个Handler，再将这个Handler传给urllib2的build_opener()函数来生成一个opener对象&#x27;&#x27;&#x27;</span><br>opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))<br><br><span class="hljs-comment"># 给urllib2openner</span><br>urllib2.install_opener(opner)<br><br><span class="hljs-comment">#使用带有cookie的urllib2访问网页</span><br>response = urllib2.urlopen(<span class="hljs-string">&quot;http://www.baidu.com/&quot;</span>)<br><br></code></pre></div></td></tr></table></figure>
<p><strong>对付反盗链</strong></p>
<p>对付”反盗链”的方式，对付防盗链，服务器会识别 headers 中的 referer 是不是它自己，如果不是，有的服务器不会响应，所以我们还可以在headers中加入 referer</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Python">&gt;&gt;&gt;headers = &#123;<span class="hljs-string">&#x27;Referer&#x27;</span>: <span class="hljs-string">&#x27;http://www.zhihu.com/articles&#x27;</span>, <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&#x27;</span>&#125;<br>headers = &#123;<span class="hljs-string">&#x27;Referer&#x27;</span>: <span class="hljs-string">&#x27;http://www.zhihu.com/articles&#x27;</span>, <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure>
<p>urllib2 默认会使用环境变量 http_proxy 来设置 HTTP Proxy。假如一个网站它会检测某一段时间某个IP 的访问次数，如果访问次数过多，它会禁止你的访问。所以你可以设置一些代理服务器来帮助你做工作，每隔一段时间换一个代理，网站君都不知道是谁在访问。 <figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br>enable_proxy = <span class="hljs-literal">True</span><br>proxy_handler = urllib2.ProxyHandler(&#123;<span class="hljs-string">&quot;http&quot;</span> : <span class="hljs-string">&#x27;http://some-proxy.com:8080&#x27;</span>&#125;)<br>null_proxy_handler = urllib2.ProxyHandler(&#123;&#125;)<br><span class="hljs-keyword">if</span> enable_proxy:<br>    opener = urllib2.build_opener(proxy_handler)<br><span class="hljs-keyword">else</span>:<br>    opener = urllib2.build_opener(null_proxy_handler)<br>urllib2.install_opener(opener)<br></code></pre></div></td></tr></table></figure> <strong>Timeout 设置</strong> urlopen方法了，第三个参数就是timeout的设置，可以设置等待多久超时，为了解决一些网站实在响应过慢而造成的影响。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br>response = urllib2.urlopen(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>, timeout=<span class="hljs-number">10</span>)<br>response = urllib2.urlopen(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>,data,<span class="hljs-number">10</span>)<br></code></pre></div></td></tr></table></figure>
<p><strong>HTTP 的 PUT 和 DELETE 方法</strong> http协议有六种请求方法，get,head,put,delete,post,options，我们有时候需要用到PUT方式或者DELETE方式请求</p>
<p><strong>PUT：这个方法比较少见。HTML表单也不支持这个。本质上来讲， PUT和POST极为相似，都是向服务器发送数据，但它们之间有一个重要区别，PUT通常指定了资源的存放位置，而POST则没有，POST的数据存放位置由服务器自己决定。 DELETE：删除某一个资源。基本上这个也很少见，不过还是有一些地方比如amazon的S3云服务里面就用的这个方法来删除资源。</strong></p>
<p>如果要使用 HTTP PUT 和 DELETE ，只能使用比较低层的 httplib 库。虽然如此，我们还是能通过下面的方式，使 urllib2 能够发出 PUT 或DELETE 的请求，不过用的次数的确是少，在这里提一下。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br>request = urllib2.Request(url,data)<br>request.get_method = <span class="hljs-keyword">lambda</span>: <span class="hljs-string">&#x27;PUT&#x27;</span> <span class="hljs-comment"># or &#x27;DELET&#x27;</span><br>response = urllib2.urlopen(request)<br></code></pre></div></td></tr></table></figure>
<p><strong>使用 Debug Log</strong> 可以通过下面的方法把 Debug Log 打开，这样收发包的内容就会在屏幕上打印出来，方便调试，这个也不太常用，仅提一下</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br>httpHandler = urllib2.HTTPHandler(debuglevel=<span class="hljs-number">1</span>)<br>httpsHandler = urllib2.HTTPSHandler(debuglevel=<span class="hljs-number">1</span>)<br>opener = urllib2.build_opener(httpHandler, httpsHandler)<br>urllib2.install_opener(opener)<br>response = urllib2.urlopen(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>)<br></code></pre></div></td></tr></table></figure>
<h1 id="网页解析器">网页解析器</h1>
<p>主要分两个方向： 1、模糊匹配：正则表达式（最后单独介绍） 2、结构化解析：<code>html.parser</code>、<code>Beautiful Soup</code>、<code>lxml</code>，结构化解析—DOM（Document Object Model）树是W3C组织官方定义的解析网页的接口。</p>
<h2 id="beautifulsoup4">beautifulsoup4</h2>
<ul>
<li>安装</li>
</ul>
<p>在C:，确认pip.exe文件是存在的情况下，pip安装即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">pip install beautifulsoup4<br></code></pre></div></td></tr></table></figure>
<ul>
<li>使用 BeautifulSoup</li>
</ul>
<p>由 <code>html</code> 网页创建beautifulsoup对象 搜索节点find_all、find： 访问节点名称、属性、文字</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-comment">#根据HTML网页创建BeautifulSoup对象</span><br>soup = BeautifulSoup(<br>					html_doc,			 <span class="hljs-comment">#Html文档字符串</span><br>					<span class="hljs-string">&#x27;html.parser&#x27;</span>		 <span class="hljs-comment">#Html解析器</span><br>					from_encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span><span class="hljs-comment">#Html文档的编码</span><br>					)<br><span class="hljs-comment">#搜索节点（find_all，find）</span><br><span class="hljs-comment">#方法：find_all(name, attrs, string)</span><br><span class="hljs-comment">#查找所有标签为a的节点</span><br>soup.find_all(<span class="hljs-string">&#x27;a&#x27;</span>)<br> <br><span class="hljs-comment">#查找所有标签为a，链接符合/view/123.html形式的节点</span><br>soup.find_all(<span class="hljs-string">&#x27;a&#x27;</span>,herf=<span class="hljs-string">&#x27;/view/123.html&#x27;</span>)<br><span class="hljs-comment">#利用正则表达式来模糊匹配</span><br>soup.find_all(<span class="hljs-string">&#x27;a&#x27;</span>,href=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;/view/\d+\.html&#x27;</span>))<br><br><span class="hljs-comment">#查找所有标签为div,class为abc，文字为Python的节点,因为Python是有class关键字的，所以用class_代表html中的class</span><br>soup.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;abc&#x27;</span>,string=<span class="hljs-string">&#x27;Python&#x27;</span>)<br><br><span class="hljs-comment">#访问得到的节点</span><br><span class="hljs-comment">#获取查找到的节点的标签名</span><br>node.name<br><br><span class="hljs-comment">#获取查找到的a节点的href属性。</span><br>node[<span class="hljs-string">&#x27;href&#x27;</span>]<br><br><span class="hljs-comment">#获取查找到的a节点的链接文字</span><br>node.get_txt()<br></code></pre></div></td></tr></table></figure>
<p><strong>实例源码</strong> <figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-built_in">type</span> = sys.getfilesystemencoding()<br><br>html_doc = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="hljs-string">&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span><br><span class="hljs-string">&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span><br><span class="hljs-string">&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span><br><span class="hljs-string">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>soup = BeautifulSoup(html_doc, <span class="hljs-string">&#x27;html.parser&#x27;</span>, from_encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;获取所有的链接&#x27;</span>.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>).encode(<span class="hljs-built_in">type</span>)<br>links = soup.find_all(<span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links:<br>	<span class="hljs-built_in">print</span> link.name, link[<span class="hljs-string">&#x27;href&#x27;</span>], link.get_text()<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;获取lacie的链接&#x27;</span>.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>).encode(<span class="hljs-built_in">type</span>)<br>link_node = soup.find(<span class="hljs-string">&#x27;a&#x27;</span>, href=<span class="hljs-string">&#x27;http://example.com/lacie&#x27;</span>)<br><span class="hljs-built_in">print</span> link_node.name, link_node[<span class="hljs-string">&#x27;href&#x27;</span>], link_node.get_text()<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;正则匹配&#x27;</span>.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>).encode(<span class="hljs-built_in">type</span>)<br>link_node = soup.find(<span class="hljs-string">&#x27;a&#x27;</span>, href=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;ill&quot;</span>))<br><span class="hljs-built_in">print</span> link_node.name, link_node[<span class="hljs-string">&#x27;href&#x27;</span>], link_node.get_text()<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;获取P段落文字&#x27;</span>.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>).encode(<span class="hljs-built_in">type</span>)<br><span class="hljs-comment">#因为Python是有class关键字的，所以用class_代表html中的class</span><br>p_node = soup.find(<span class="hljs-string">&#x27;p&#x27;</span>, class_=<span class="hljs-string">&#x27;title&#x27;</span>)<br><span class="hljs-built_in">print</span> p_node.name, p_node.get_text()<br></code></pre></div></td></tr></table></figure></p>
<h2 id="python的正则表达式">Python的正则表达式</h2>
<figure>
<img src="https://i.loli.net/2020/04/12/Ep45IMnHitqQVWf.png" srcset="/img/loading.gif" alt="regular expression.jpg" /><figcaption aria-hidden="true">regular expression.jpg</figcaption>
</figure>
<p>正则表达式是对字符串操作的一种逻辑公式，就是用事先定义好的一些特定字符、及这些特定字符的组合，组成一个“规则字符串”，这个“规则字符串”用来表达对字符串的一种过滤逻辑。</p>
<p>正则表达式的大致匹配过程是：</p>
<ol type="1">
<li>依次拿出表达式和文本中的字符比较，</li>
<li>如果每一个字符都能匹配，则匹配成功；一旦有匹配不成功的字符则匹配失败。</li>
<li>如果表达式中有量词或边界，这个过程会稍微有一些不同。</li>
</ol>
<h3 id="正则表达式相关注解">正则表达式相关注解</h3>
<h4 id="数量词的贪婪模式与非贪婪模式">数量词的贪婪模式与非贪婪模式</h4>
<p>正则表达式通常用于在文本中查找匹配的字符串。<strong>Python里数量词默认是贪婪的（在少数语言里也可能是默认非贪婪），总是尝试匹配尽可能多的字符</strong>；非贪婪的则相反，总是尝试匹配尽可能少的字符。例如：正则表达式 ”ab*” 如果用于查找 ”abbbc”，将找到 ”abbb”。而如果使用非贪婪的数量词”ab*?”，将找到”a”。</p>
<p>注：我们一般使用非贪婪模式来提取。</p>
<h4 id="反斜杠问题">反斜杠问题</h4>
<p>与大多数编程语言相同，正则表达式里使用””作为转义字符，这就可能造成反斜杠困扰。假如你需要匹配文本中的字符””，那么使用编程语言表示的正则表达式里将需要4个反斜杠”\\”：前两个和后两个分别用于在编程语言里转义成反斜杠，转换成两个反斜杠后再在正则表达式里转义成一个反斜杠。</p>
<p>Python里的原生字符串很好地解决了这个问题，这个例子中的<strong>正则表达式可以使用r”\”表示</strong>。同样，匹配一个数字的”\d”可以写成r”。有了原生字符串，妈妈也不用担心是不是漏写了反斜杠，写出来的表达式也更直观勒。</p>
<h3 id="python的re模块">Python的re模块</h3>
<h4 id="pattern">pattern</h4>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#返回pattern对象</span><br>re.<span class="hljs-built_in">compile</span>(string[,flag])  <br><span class="hljs-comment">#以下为匹配所用函数</span><br>re.match(pattern, string[, flags])<br>re.search(pattern, string[, flags])<br>re.split(pattern, string[, maxsplit])<br>re.findall(pattern, string[, flags])<br>re.finditer(pattern, string[, flags])<br>re.sub(pattern, repl, string[, count])<br>re.subn(pattern, repl, string[, count])<br></code></pre></div></td></tr></table></figure>
<p><strong>pattern可以理解为一个匹配模式</strong>，利用re.compile方法就可以获得一个pattern,例如：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Python">pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;Hello&#x27;</span>) <span class="hljs-comment">#注意hello前面的r的意思是“原生字符串”</span><br></code></pre></div></td></tr></table></figure>
<p>在参数中我们传入了原生字符串对象，通过compile方法编译生成一个pattern对象，然后我们利用这个对象来进行进一步的匹配。re.compile(string[,flag])，另外一个参数flag是匹配模式，取值可以使用按位或运算符’|’表示同时生效，比如re.I | re.M。可选值有：</p>
<figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript">• re.I(全拼：IGNORECASE): 忽略大小写（括号内是完整写法，下同）<br>• re.M(全拼：MULTILINE): 多行模式，改变<span class="hljs-string">&#x27;^&#x27;</span>和<span class="hljs-string">&#x27;$&#x27;</span>的行为（参见上图）<br>• re.S(全拼：DOTALL): 点任意匹配模式，改变<span class="hljs-string">&#x27;.&#x27;</span>的行为<br>• re.L(全拼：LOCALE): 使预定字符类 <span class="hljs-string">\w</span> <span class="hljs-string">\W</span> <span class="hljs-string">\b</span> <span class="hljs-string">\B</span> <span class="hljs-string">\s</span> <span class="hljs-string">\S</span> 取决于当前区域设定 <span class="hljs-string">\w表示任意字母或数字</span> <span class="hljs-string">\d表示任意数字</span><br>• re.U(全拼：UNICODE): 使预定字符类 <span class="hljs-string">\w</span> <span class="hljs-string">\W</span> <span class="hljs-string">\b</span> <span class="hljs-string">\B</span> <span class="hljs-string">\s</span> <span class="hljs-string">\S</span> <span class="hljs-string">\d</span> <span class="hljs-string">\D</span> 取决于unicode定义的字符属性<br>• re.X(全拼：VERBOSE): 详细模式。这个模式下正则表达式可以是多行，忽略空白字符，并可以加入注释。<br></code></pre></div></td></tr></table></figure>
<p><strong>注：以下七个方法中的flags同样是代表匹配模式的意思，如果在pattern生成时已经指明了flags，那么在下面的方法中就不需要传入这个参数了</strong></p>
<h4 id="re.match">re.match()</h4>
<p><code>re.match(pattern, string[, flags])</code>， 必须从开头匹]配正则 match匹配必须从目标字符串的开头就开始匹配，如果开头不是目标字符串</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Created on 2016年4月25日</span><br><span class="hljs-string"></span><br><span class="hljs-string">@author: Tony</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#导入re模块</span><br><span class="hljs-keyword">import</span> re<br> <br><span class="hljs-comment"># 将正则表达式编译成Pattern对象，注意hello前面的r的意思是“原生字符串”</span><br>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;helo&#x27;</span>)<br> <br><span class="hljs-comment"># 使用re.match匹配文本，获得匹配结果，无法匹配时将返回None</span><br>result1 = re.match(pattern,<span class="hljs-string">&#x27;hello&#x27;</span>)<br>result2 = re.match(pattern,<span class="hljs-string">&#x27;helloo CQC!&#x27;</span>)<br>result3 = re.match(pattern,<span class="hljs-string">&#x27;helo CQC!&#x27;</span>)<br>result4 = re.match(pattern,<span class="hljs-string">&#x27;hello CQC!&#x27;</span>)<br> <br><span class="hljs-comment">#如果1匹配成功</span><br><span class="hljs-keyword">if</span> result1:<br>    <span class="hljs-comment"># 使用Match获得分组信息</span><br>    <span class="hljs-built_in">print</span> result1.group()<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;1匹配失败！&#x27;</span><br> <br> <br><span class="hljs-comment">#如果2匹配成功</span><br><span class="hljs-keyword">if</span> result2:<br>    <span class="hljs-comment"># 使用Match获得分组信息</span><br>    <span class="hljs-built_in">print</span> result2.group()<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;2匹配失败！&#x27;</span><br> <br> <br><span class="hljs-comment">#如果3匹配成功</span><br><span class="hljs-keyword">if</span> result3:<br>    <span class="hljs-comment"># 使用Match获得分组信息</span><br>    <span class="hljs-built_in">print</span> result3.group()<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;3匹配失败！&#x27;</span><br> <br><span class="hljs-comment">#如果4匹配成功</span><br><span class="hljs-keyword">if</span> result4:<br>    <span class="hljs-comment"># 使用Match获得分组信息</span><br>    <span class="hljs-built_in">print</span> result4.group()<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;4匹配失败！&#x27;</span><br></code></pre></div></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">hello<br>hello<br>3匹配失败！<br>hello<br></code></pre></div></td></tr></table></figure>
<p>match对象的的属性和方法，Match对象是一次匹配的结果，包含了很多关于此次匹配的信息，可以使用Match提供的可读属性或方法来获取这些信息。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">属性：<br><span class="hljs-number">1.</span>string: 匹配时使用的文本。<br><span class="hljs-number">2.</span>re: 匹配时使用的Pattern对象。<br><span class="hljs-number">3.</span>pos: 文本中正则表达式开始搜索的索引。值与Pattern.match()和Pattern.seach()方法的同名参数相同。<br><span class="hljs-number">4.</span>endpos: 文本中正则表达式结束搜索的索引。值与Pattern.match()和Pattern.seach()方法的同名参数相同。<br><span class="hljs-number">5.</span>lastindex: 最后一个被捕获的分组在文本中的索引。如果没有被捕获的分组，将为<span class="hljs-keyword">None</span>。<br><span class="hljs-number">6.</span>lastgroup: 最后一个被捕获的分组的别名。如果这个分组没有别名或者没有被捕获的分组，将为<span class="hljs-keyword">None</span>。<br>方法：<br><span class="hljs-number">1.</span><span class="hljs-keyword">group</span>([group1, …]):<br>获得一个或多个分组截获的字符串；指定多个参数时将以元组形式返回。group1可以使用编号也可以使用别名；编号<span class="hljs-number">0</span>代表整个匹配的子串；不填写参数时，返回<span class="hljs-keyword">group</span>(<span class="hljs-number">0</span>)；没有截获字符串的组返回<span class="hljs-keyword">None</span>；截获了多次的组返回最后一次截获的子串。<br><span class="hljs-number">2.</span><span class="hljs-keyword">groups</span>([<span class="hljs-keyword">default</span>]):<br>以元组形式返回全部分组截获的字符串。相当于调用<span class="hljs-keyword">group</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,…last)。<span class="hljs-keyword">default</span>表示没有截获字符串的组以这个值替代，默认为<span class="hljs-keyword">None</span>。<br><span class="hljs-number">3.</span>groupdict([<span class="hljs-keyword">default</span>]):<br>返回以有别名的组的别名为键、以该组截获的子串为值的字典，没有别名的组不包含在内。<span class="hljs-keyword">default</span>含义同上。<br><span class="hljs-number">4.</span><span class="hljs-keyword">start</span>([<span class="hljs-keyword">group</span>]):<br>返回指定的组截获的子串在string中的起始索引（子串第一个字符的索引）。<span class="hljs-keyword">group</span>默认值为<span class="hljs-number">0</span>。<br><span class="hljs-number">5.</span><span class="hljs-keyword">end</span>([<span class="hljs-keyword">group</span>]):<br>返回指定的组截获的子串在string中的结束索引（子串最后一个字符的索引+<span class="hljs-number">1</span>）。<span class="hljs-keyword">group</span>默认值为<span class="hljs-number">0</span>。<br><span class="hljs-number">6.</span>span([<span class="hljs-keyword">group</span>]):<br>返回(<span class="hljs-keyword">start</span>(<span class="hljs-keyword">group</span>), <span class="hljs-keyword">end</span>(<span class="hljs-keyword">group</span>))。<br><span class="hljs-number">7.</span>expand(<span class="hljs-keyword">template</span>):<br>将匹配到的分组代入<span class="hljs-keyword">template</span>中然后返回。<span class="hljs-keyword">template</span>中可以使用\id或\g、\g引用分组，但不能使用编号<span class="hljs-number">0</span>。\id与\g是等价的；但\<span class="hljs-number">10</span>将被认为是第<span class="hljs-number">10</span>个分组，如果你想表达\<span class="hljs-number">1</span>之后是字符’<span class="hljs-number">0</span>’，只能使用\g0。<br></code></pre></div></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment">#一个简单的match实例</span><br> <br><span class="hljs-keyword">import</span> re<br><span class="hljs-comment"># 匹配如下内容：单词+空格+单词+任意字符</span><br>m = re.match(<span class="hljs-string">r&#x27;(\w+) (\w+)(?P&lt;sign&gt;.*)&#x27;</span>, <span class="hljs-string">&#x27;hello world!&#x27;</span>)<br> <br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.string:&quot;</span>, m.string<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.re:&quot;</span>, m.re<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.pos:&quot;</span>, m.pos<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.endpos:&quot;</span>, m.endpos<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.lastindex:&quot;</span>, m.lastindex<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.lastgroup:&quot;</span>, m.lastgroup<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.group():&quot;</span>, m.group()<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.group(1,2):&quot;</span>, m.group(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.groups():&quot;</span>, m.groups()<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.groupdict():&quot;</span>, m.groupdict()<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.start(2):&quot;</span>, m.start(<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.end(2):&quot;</span>, m.end(<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m.span(2):&quot;</span>, m.span(<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-string">r&quot;m.expand(r&#x27;\g \g\g&#x27;):&quot;</span>, m.expand(<span class="hljs-string">r&#x27;\2 \1\3&#x27;</span>)<br> <br><span class="hljs-comment">### output ###</span><br><span class="hljs-comment"># m.string: hello world!</span><br><span class="hljs-comment"># m.re: </span><br><span class="hljs-comment"># m.pos: 0</span><br><span class="hljs-comment"># m.endpos: 12</span><br><span class="hljs-comment"># m.lastindex: 3</span><br><span class="hljs-comment"># m.lastgroup: sign</span><br><span class="hljs-comment"># m.group(1,2): (&#x27;hello&#x27;, &#x27;world&#x27;)</span><br><span class="hljs-comment"># m.groups(): (&#x27;hello&#x27;, &#x27;world&#x27;, &#x27;!&#x27;)</span><br><span class="hljs-comment"># m.groupdict(): &#123;&#x27;sign&#x27;: &#x27;!&#x27;&#125;</span><br><span class="hljs-comment"># m.start(2): 6</span><br><span class="hljs-comment"># m.end(2): 11</span><br><span class="hljs-comment"># m.span(2): (6, 11)</span><br><span class="hljs-comment"># m.expand(r&#x27;\2 \1\3&#x27;): world hello!</span><br></code></pre></div></td></tr></table></figure>
<h4 id="re.search">re.search()</h4>
<p><code>re.search(pattern, string[, flags])</code>，全文搜索正则。 search方法与match方法极其类似，区别在<strong>于match()函数只检测re是不是在string的开始位置匹配，search()会扫描整个string查找匹配</strong>，match()只有在0位置匹配成功的话才有返回，如果不是开始位置匹配成功的话，match()就返回None。同样，search方法的返回对象同样match()返回对象的方法和属性。我们用一个例子感受一下</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> re<br> <br><span class="hljs-comment"># 将正则表达式编译成Pattern对象</span><br>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;world&#x27;</span>)<br><span class="hljs-comment"># 使用search()查找匹配的子串，不存在能匹配的子串时将返回None</span><br><span class="hljs-comment"># 这个例子中使用match()无法成功匹配</span><br>match = re.search(pattern,<span class="hljs-string">&#x27;hello world!&#x27;</span>)<br><span class="hljs-keyword">if</span> match:<br>    <span class="hljs-comment"># 使用Match获得分组信息</span><br>    <span class="hljs-built_in">print</span> match.group()<br><span class="hljs-comment">### 输出 ###</span><br><span class="hljs-comment"># world</span><br></code></pre></div></td></tr></table></figure>
<h4 id="re.split">re.split()</h4>
<p><code>re.split(pattern, string[, maxsplit])</code> 分割正则 按照能够匹配的子串将string分割后返回列表。maxsplit用于指定最大分割次数，不指定将全部分割。我们通过下面的例子感受一下。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\s+&#x27;</span>) <span class="hljs-comment">#\s是空格的意思</span><br><span class="hljs-built_in">print</span> re.split(pattern,<span class="hljs-string">&#x27;one1 tw o2three3fo ur4&#x27;</span>)<br> <br><span class="hljs-comment">### 输出 ###</span><br><span class="hljs-comment"># [&#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;, &#x27;four&#x27;, &#x27;&#x27;]</span><br></code></pre></div></td></tr></table></figure>
<h4 id="re.findall">re.findall()</h4>
<p><code>re.findall(pattern, string[, flags])</code> 以列表返回所有正则 搜索string，以列表形式返回全部能匹配的子串。我们通过这个例子来感受一下</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\d+&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> re.findall(pattern,<span class="hljs-string">&#x27;one1two2three3four4&#x27;</span>)<br>[<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>]<br></code></pre></div></td></tr></table></figure>
<h4 id="re.finditer">re.finditer()</h4>
<p><code>re.finditer(pattern, string[, flags])</code> 以迭代器返回所有搜索string，返回一个顺序访问每一个匹配结果（Match对象）的迭代器。我们通过下面的例子来感受一下</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\d+&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> re.finditer(pattern,<span class="hljs-string">&#x27;one1two2three3four4&#x27;</span>):<br>	<span class="hljs-built_in">print</span> m.group()	<br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span> <br><span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure>
<h4 id="re.sub">re.sub()</h4>
<p><code>re.sub(pattern, repl, string[, count])</code> 替换正则 使用repl替换string中每一个匹配到了的子串后返回替换后的字符串。 当repl是一个字符串时，可以使用 <code>\id</code> 或 <code>\g</code>、<code>\g</code> 引用分组，但不能使用编号0。 当repl是一个方法时，这个方法应当只接受一个参数（Match对象），并返回一个字符串用于替换（返回的字符串中不能再引用分组）。count用于指定最多替换次数，不指定时全部替换。</p>
<figure class="highlight python-repl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python-repl"><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-keyword">import</span> re</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;(\w+) (\w+)&#x27;</span>)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">s = <span class="hljs-string">&#x27;i say,hello worlrd!&#x27;</span></span><br>#下面这句话是先按照pattern匹配s，得到group(1)：say i和group(2)：worlrd hello,然后用（r&#x27;\2 \1&#x27;）来替换匹配到的内容，替换的结果就是前后互换。<br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-built_in">print</span> re.sub(pattern,<span class="hljs-string">r&#x27;\2 \1&#x27;</span>,s) <span class="hljs-comment">#\1、\2等表示查找里面各个括号对应的匹配内容，也就是具体搜索到的内容，这里是将\2 和\1互换位置</span></span><br>say i,worlrd hello!<br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">func</span>(<span class="hljs-params">m</span>):</span></span><br>	return m.group(1).title()+&#x27; &#x27;+m.group(2).title()<br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-built_in">print</span> re.sub(pattern,func,s)</span><br>I Say,Hello Worlrd!<br><br></code></pre></div></td></tr></table></figure>
<h4 id="re.subn">re.subn()</h4>
<p><code>re.subn(pattern, repl, string[, count])</code> 替换并统计次数正则 返回 (sub(repl, string[, count]), 替换次数)。 <strong>也就是说，使用subn时，会返回替换的次数。</strong></p>
<figure class="highlight python-repl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python-repl"><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;(\w+) (\w+)&#x27;</span>)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">s = <span class="hljs-string">&#x27;i say,hello world&#x27;</span></span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-built_in">print</span> re.subn(pattern,<span class="hljs-string">r&#x27;\2 \1&#x27;</span>,s)</span><br>(&#x27;say i,world hello&#x27;, 2)<br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">funccopy</span>(<span class="hljs-params">m</span>):</span></span><br>	return m.group(1).title()+&#x27; &#x27;+m.group(2).title()<br><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python"><span class="hljs-built_in">print</span> re.subn(pattern,funccopy(),s)</span><br>(&#x27;I Say,Hello World&#x27;, 2)<br></code></pre></div></td></tr></table></figure>
<h3 id="python的模块的另一种使用方法">Python的模块的另一种使用方法</h3>
<p>可以通过 <code>pattern.match</code>，<code>pattern.search</code> 调用，这样调用便不用将 <code>pattern</code> 作为第一个参数传入了，大家想怎样调用皆可。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"> match(string[, pos[, endpos]]) | re.match(pattern, string[, flags])<br> search(string[, pos[, endpos]]) | re.search(pattern, string[, flags])<br> split(string[, maxsplit]) | re.split(pattern, string[, maxsplit])<br> findall(string[, pos[, endpos]]) | re.findall(pattern, string[, flags])<br> finditer(string[, pos[, endpos]]) | re.finditer(pattern, string[, flags])<br> sub(repl, string[, count]) | re.sub(pattern, repl, string[, count])<br> subn(repl, string[, count]) |re.sub(pattern, repl, string[, count])<br><br><span class="hljs-comment">#举例说明</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;(\w+) (\w+)&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>s = <span class="hljs-string">&#x27;i say,hello world&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> pattern.subn(<span class="hljs-string">r&#x27;\2 \1&#x27;</span>,s)<br>(<span class="hljs-string">&#x27;say i,world hello&#x27;</span>, <span class="hljs-number">2</span>)<br><span class="hljs-comment">#或者</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\d+&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>s = <span class="hljs-string">&#x27;one1two2three3four4&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> pattern.split(s)<br>[<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>, <span class="hljs-string">&#x27;four&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><br></code></pre></div></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html">正则部分的内容整理自了此链接</a></p>
<h1 id="urlerror异常处理">URLError异常处理</h1>
<p>首先解释下URLError可能产生的原因： 1、网络无连接，即本机无法上网 2、连接不到特定的服务器 3、服务器不存在</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2 <br>request = urllib2.Request(<span class="hljs-string">&#x27;http://www.xxdsafasdxx.com/&#x27;</span>)<br><span class="hljs-keyword">try</span>:<br>    response = urllib2.urlopen(request)<br>    <span class="hljs-built_in">print</span> response.getcode()<br><span class="hljs-keyword">except</span> urllib2.URLError <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Error is &#x27;</span>+<span class="hljs-built_in">str</span>(err) <br></code></pre></div></td></tr></table></figure>
<p>输出 <figure class="highlight subunit"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs subunit"><span class="hljs-keyword">Error </span>is &lt;urlopen error [Errno 10060] &gt;<br></code></pre></div></td></tr></table></figure> HTTP状态码表示HTTP协议所返回的响应的状态。下面将状态码归结如下： 100：继续 客户端应当继续发送请求。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。 101： 转换协议 在发送完这个响应最后的空行后，服务器将会切换到在Upgrade 消息头中定义的那些协议。只有在切换新的协议更有好处的时候才应该采取类似措施。 102：继续处理 由WebDAV（RFC 2518）扩展的状态码，代表处理将被继续执行。 200：请求成功 处理方式：获得响应的内容，进行处理 201：请求完成，结果是创建了新资源。新创建资源的URI可在响应的实体中得到 处理方式：爬虫中不会遇到。 202：请求被接受，但处理尚未完成 处理方式：阻塞等待 204：服务器端已经实现了请求，但是没有返回新的信 息。如果客户是用户代理，则无须为此更新自身的文档视图。 处理方式：丢弃 300：该状态码不被HTTP/1.0的应用程序直接使用， 只是作为3XX类型回应的默认解释。存在多个可用的被请求资源。 处理方式：若程序中能够处理，则进行进一步处理，如果程序中不能处理，则丢弃 301：请求到的资源都会分配一个永久的URL，这样就可以在将来通过该URL来访问此资源 处理方式：重定向到分配的URL 302：请求到的资源在一个不同的URL处临时保存 处理方式：重定向到临时的URL 304：请求的资源未更新 处理方式：丢弃 400：非法请求 处理方式：丢弃 401：未授权 处理方式：丢弃 403：禁止 处理方式：丢弃 404：没有找到 处理方式：丢弃 500：服务器内部错误 服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器端的源代码出现错误时出现。 501：服务器无法识别 服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。 502：错误网关 作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。 503：服务出错 由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。</p>
<p>HTTPError实例产生后会有一个code属性，这就是是服务器发送的相关错误号。 因为urllib2可以为你处理重定向，也就是3开头的代号可以被处理，并且100-299范围的号码指示成功，所以你只能看到400-599的错误号码。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">req = urllib2.Request(<span class="hljs-string">&#x27;http://blog.csdn.net/cqcre&#x27;</span>)<br><span class="hljs-keyword">try</span>:<br>    urllib2.urlopen(req)<br><span class="hljs-keyword">except</span> urllib2.HTTPError, e:<br>    <span class="hljs-built_in">print</span> e.code<br>    <span class="hljs-built_in">print</span> e.reason<br></code></pre></div></td></tr></table></figure>
<p>输出： <figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs plain">403<br>Forbidden<br></code></pre></div></td></tr></table></figure> HTTPError的父类是URLError，根据编程经验，<strong>父类的异常应当写到子类异常的后面</strong>，如果子类捕获不到，那么可以捕获父类的异常，所以上述的代码可以这么改写 <figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br>req = urllib2.Request(<span class="hljs-string">&#x27;http://blog.csdn.net/cqcre&#x27;</span>)<br><span class="hljs-keyword">try</span>:<br>    urllib2.urlopen(req)<br><span class="hljs-keyword">except</span> urllib2.HTTPError, e:<br>    <span class="hljs-built_in">print</span> e.code<br><span class="hljs-keyword">except</span> urllib2.URLError, e:<br>    <span class="hljs-built_in">print</span> e.reason<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;OK&quot;</span><br></code></pre></div></td></tr></table></figure> # cookie的获取和使用</p>
<p>Cookie，指某些网站为了辨别用户身份、进行session跟踪而** **上的数据（通常经过加密）</p>
<p>比如说有些网站需要登录后才能访问某个页面，在登录之前，你想抓取某个页面内容是不允许的。那么我们可以利用Urllib2库保存我们登录的Cookie，然后再抓取其他页面就达到目的了。</p>
<p>当你获取一个URL你使用一个opener(一个urllib2.OpenerDirector的实例)。在前面，我们都是使用的默认的opener，也就是urlopen。它是一个特殊的opener，可以理解成opener的一个特殊实例，传入的参数仅仅是url，data，timeout。</p>
<p>如果我们需要用到Cookie，只用这个opener是不能达到目的的，所以我们需要创建更一般的opener来实现对Cookie的设置。</p>
<p>cookielib模块的主要作用是提供可存储cookie的对象，以便于与urllib2模块配合使用来访问Internet资源。Cookielib模块非常强大，我们可以利用本模块的 类的对象来捕获cookie并在后续连接请求时重新发送，比如可以实现模拟登录功能。该模块主要的对象有CookieJar、FileCookieJar、MozillaCookieJar、LWPCookieJar。</p>
<p><strong>它们的关系：CookieJar —-派生—-&gt;FiCookieJarleCookieJar —-派生—–&gt;MozillaCookieJar和LWPCookieJar</strong></p>
<h2 id="获取cookie保存到变量">获取cookie保存到变量</h2>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-keyword">import</span> cookielib<br><br>cookie = cookielib.CookieJar() <span class="hljs-comment">#声明一个CookieJar对象实例来保存cookie</span><br><br>handler=urllib2.HTTPCookieProcessor(cookie) <span class="hljs-comment">#利用urllib2库的HTTPCookieProcessor对象来创建cookie处理器</span><br><br>opener = urllib2.build_opener(handler) <span class="hljs-comment">#通过handler来构建opener</span><br><br>response = opener.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>) <span class="hljs-comment">#此处的open方法同urllib2的urlopen方法，也可以传入request</span><br><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> cookie:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Name = &#x27;</span>+item.name<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Value = &#x27;</span>+item.value<br><br></code></pre></div></td></tr></table></figure>
<p>输出 <figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">Name</span> = BAIDUID<br><span class="hljs-attribute">Value</span> = <span class="hljs-number">3</span>CDE<span class="hljs-number">78</span>A<span class="hljs-number">0</span>F<span class="hljs-number">326492</span>D<span class="hljs-number">542</span>AE<span class="hljs-number">1</span>C<span class="hljs-number">3</span>FE<span class="hljs-number">209</span>D<span class="hljs-number">68</span>:FG=<span class="hljs-number">1</span><br><span class="hljs-attribute">Name</span> = BIDUPSID<br><span class="hljs-attribute">Value</span> = <span class="hljs-number">3</span>CDE<span class="hljs-number">78</span>A<span class="hljs-number">0</span>F<span class="hljs-number">326492</span>D<span class="hljs-number">542</span>AE<span class="hljs-number">1</span>C<span class="hljs-number">3</span>FE<span class="hljs-number">209</span>D<span class="hljs-number">68</span><br><span class="hljs-attribute">Name</span> = H_PS_PSSID<br><span class="hljs-attribute">Value</span> = <span class="hljs-number">18881</span>_<span class="hljs-number">19719</span>_<span class="hljs-number">1443</span>_<span class="hljs-number">19671</span>_<span class="hljs-number">19721</span>_<span class="hljs-number">19781</span>_<span class="hljs-number">17948</span>_<span class="hljs-number">19803</span>_<span class="hljs-number">19806</span>_<span class="hljs-number">19558</span>_<span class="hljs-number">19808</span>_<span class="hljs-number">18559</span>_<span class="hljs-number">15466</span>_<span class="hljs-number">12397</span>_<span class="hljs-number">10632</span><br><span class="hljs-attribute">Name</span> = PSTM<br><span class="hljs-attribute">Value</span> = <span class="hljs-number">1461513550</span><br><span class="hljs-attribute">Name</span> = BDSVRTM<br><span class="hljs-attribute">Value</span> = <span class="hljs-number">0</span><br><span class="hljs-attribute">Name</span> = BD_HOME<br><span class="hljs-attribute">Value</span> = <span class="hljs-number">0</span><br></code></pre></div></td></tr></table></figure> ## 将cookie保存到文件</p>
<p>使用FileCookieJar的子类MozillaCookieJar来实现Cookie的保存</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br>filename = <span class="hljs-string">&#x27;cookie.txt&#x27;</span> <span class="hljs-comment">#设置保存cookie的文件，同级目录下的cookie.txt</span><br><br>cookie = cookielib.MozillaCookieJar(filename) <span class="hljs-comment">#声明一个MozillaCookieJar对象实例来保存cookie，之后写入文件</span><br><br>handler = urllib2.HTTPCookieProcessor(cookie) <span class="hljs-comment">#利用urllib2库的HTTPCookieProcessor对象来创建cookie处理器</span><br><br>opener = urllib2.build_opener(handler) <span class="hljs-comment">#通过handler来构建opener，和上面的那句话可以合并来写，opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie))</span><br><br>response = opener.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>) <span class="hljs-comment">#创建一个请求，原理同urllib2的urlopen</span><br><br>cookie.save(ignore_discard=<span class="hljs-literal">True</span>, ignore_expires=<span class="hljs-literal">True</span>) <span class="hljs-comment">#保存到cookie文件中</span><br></code></pre></div></td></tr></table></figure>
<p>关于最后save方法的两个参数在此说明一下： ignore_discard的意思是即使cookies将被丢弃也将它保存下来， ignore_expires的意思是如果在该文件中cookies已经存在，则覆盖原文件写入， 我们将这两个全部设置为True。运行之后，cookies将被保存到cookie.txt文件中。</p>
<h2 id="从文件中获取cookie并访问">从文件中获取Cookie并访问</h2>
<p>以后要访问一个网站的话，可以从文件中把cookie读取出来再访问网站。</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> urllib2<br><br>cookie = cookielib.MozillaCookieJar() <span class="hljs-comment">#创建MozillaCookieJar实例对象，为保存取出来的cookie做准备</span><br><br>cookie.load(<span class="hljs-string">&#x27;cookie.txt&#x27;</span>, ignore_discard=<span class="hljs-literal">True</span>, ignore_expires=<span class="hljs-literal">True</span>) <span class="hljs-comment">#调用cookie的load方法，从文件中读取cookie内容到变量</span><br><br>request = urllib2.Request(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>) <span class="hljs-comment">#创建请求的request </span><br><br>opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie)) <span class="hljs-comment">#利用urllib2的build_opener方法创建一个opener</span><br><br>response = opener.<span class="hljs-built_in">open</span>(request)<br><br><span class="hljs-built_in">print</span> response.read()<br></code></pre></div></td></tr></table></figure>
<h2 id="一个用cookie模拟登陆的实例">一个用cookie模拟登陆的实例</h2>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-keyword">import</span> cookielib<br><br>filename = <span class="hljs-string">&#x27;cookie.txt&#x27;</span><br><br>cookie = cookielib.MozillaCookieJar(filename) <span class="hljs-comment">#声明一个MozillaCookieJar对象实例来保存cookie，之后写入文件</span><br><br>opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie)) <span class="hljs-comment">#在这里openner已经拥有了cookiie属性了</span><br><br>postdata = urllib.urlencode(&#123;<br>			<span class="hljs-string">&#x27;stuid&#x27;</span>:<span class="hljs-string">&#x27;201200131012&#x27;</span>,<br>			<span class="hljs-string">&#x27;pwd&#x27;</span>:<span class="hljs-string">&#x27;23342321&#x27;</span><br>		&#125;) <span class="hljs-comment">#录入账号密码等信息</span><br><br>loginUrl = <span class="hljs-string">&#x27;http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login&#x27;</span> <span class="hljs-comment">#登录教务系统的URL</span><br><br>result = opener.<span class="hljs-built_in">open</span>(loginUrl,postdata) <span class="hljs-comment">#模拟登录，并把cookie保存到变量</span><br><br>cookie.save(ignore_discard=<span class="hljs-literal">True</span>, ignore_expires=<span class="hljs-literal">True</span>) <span class="hljs-comment">#保存cookie到cookie.txt中</span><br><br>gradeUrl = <span class="hljs-string">&#x27;http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bkscjcx.curscopre&#x27;</span> <span class="hljs-comment">#利用cookie请求访问另一个网址，此网址是成绩查询网址</span><br><br>result = opener.<span class="hljs-built_in">open</span>(gradeUrl) <span class="hljs-comment">#请求访问成绩查询网址</span><br><br><span class="hljs-built_in">print</span> result.read()<br></code></pre></div></td></tr></table></figure>
<h2 id="opener.open方法和urlopen用post方法比较">opener.open方法和urlopen用POST方法比较</h2>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Python"><span class="hljs-comment">#opener.open方法传递账号密码的逻辑顺序：将账户密码等信息存到一个dict（postdata）里面 ---&gt; 利用opener.open方法以登录url和dict（postdata）为参数得到一个result ---&gt; print result.read()</span><br><br><br><span class="hljs-comment">#urlopen用POST方法传账户密码的逻辑顺序：账号密码信息存到一个dict（valuse）里面 ---&gt; 用urllib的urlencode方法把dict（valuse）里面的账户、密码信息封装到data里面 ---&gt; 用urllib2的Request以目标url和data为参数生成一个request ---&gt; 调用urllib2的urlopen方法以request为参数获得response ---&gt; response.read()</span><br></code></pre></div></td></tr></table></figure>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/python/">python</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E8%BD%AC%E8%BD%BD/">转载</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/04/12/Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Python异常处理</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/04/12/%E5%89%91%E6%8C%87offer-%E9%9D%A2%E8%AF%95%E9%A2%9805-%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC%EF%BC%88%E6%98%93%EF%BC%89/">
                        <span class="hidden-mobile">剑指offer 面试题05. 替换空格（易）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'http://example.com/2020/04/12/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/';
        this.page.identifier = '/2020/04/12/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/';
      };
      Fluid.utils.waitElementVisible('disqus_thread', function () {
        var d = document, s = d.createElement('script');
        s.src = '//' + 'codesisart' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', new Date());
        (d.head || d.body).appendChild(s);
      });
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a>
    </noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8.8.3/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>







<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>

<!-- <script type="text/javascript" src="/js/cdnjs.cloudflare.com_ajax_libs_mathjax_2.7.1_MathJax.js_config=TeX-MML-AM_CHTML"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->


</body>
</html>
